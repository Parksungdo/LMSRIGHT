<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.adm.dao.LectureManagementDao">

	<!-- 강의 목록 조회 -->
   <select id="lectureListSearch" resultType="kr.happyjob.study.adm.model.LectureManagementModel">
      /*kr.happyjob.study.adm.dao.LectureManagementDAO.lectureListSearch*/      
      SELECT	lc.lecture_no
                  , lc.loginID
                  , dc.detail_name as lecture_name
                  , ui.name as teacher_name
                  , lc.lecture_person
                  , lc.lecture_total
                  , lc.lecture_goal
                  , lc.lecture_start
                  , lc.lecture_end
                  , lc.lecture_confirm
	  	FROM	tb_lecture lc
          		inner join tb_detail_code dc on dc.group_code = 'lecture_no' and dc.detail_code = lc.lecture_no
          		inner join tb_userinfo ui on lc.loginID = ui.loginID
      <where>
				<if test="(lectureName != null) and (!lectureName.equals(''))">
				      and lc.lecture_no = #{lectureName}
				</if> 
				
				<if test="(searchWord != null) and (!searchWord.equals(''))">
				      and lecture_total <![CDATA[>=]]> #{searchWord}      	
				</if>
				
	  </where>
       ORDER BY lecture_name DESC
       LIMIT #{startnum}, #{pageSize}
   </select>
   
   <!-- 강의 목록 총 갯수 조회 -->
   <select id="lectureListCnt" resultType="int">
      /*kr.happyjob.study.adm.dao.LectureManagementDAO.lectureListCnt*/ 
      SELECT	count(*)
	  	FROM	tb_lecture lc
          		inner join tb_detail_code dc on dc.group_code = 'lecture_no' and dc.detail_code = lc.lecture_no
      <where>
				<if test="(lectureName != null) and (!lectureName.equals(''))">
				      and lc.lecture_no = #{lectureName}
				</if> 
				
				<if test="(searchWord != null) and (!searchWord.equals(''))">
				      and lecture_total <![CDATA[>=]]> #{searchWord}      	
				</if>
				
	  </where> 
   </select>
 <!--   
   <insert id="lectureInsertComnDtlCod">
   		<selectKey resultType="int" keyProperty="detailCode" order="BEFORE">
             (select max(detail_code)  + 1 from tb_detail_code where group_code = 'lecture_no')
        </selectKey> 
   
		/*kr.happy.study.system.dao.ComnCodDao.insertComnDtlCod*/
		INSERT INTO tb_detail_code
		(
			  group_code, detail_code, detail_name,  note, use_yn, reg_date
			, regId, update_date, updateId
		)
		VALUES
		(
				'lecture_no'
			,	#{detailCode}
			,	#{lectureName}
			,	#{dtl_cod_eplti}
			, 	'Y'
			,	NOW()
			,	#{loginId}
			,	NOW()
			,	#{loginId}
		)
	</insert>
    -->
	<!-- 강의 insert -->
	<insert id="lectureInsert">
	   
	
	
		insert into tb_lecture
			(
				lecture_no,
 				loginID, 
 				test_no, 
 				lecture_person, 
 				lecture_total, 
 				lecture_goal, 
 				lecture_start,
 				lecture_end,
				lecture_confirm
			)values(
				(select detail_code from tb_detail_code where group_code = 'lecture_no' and detail_name = #{lectureName}),
				#{loginID},
				#{testNo},
				#{lecturePerson},
				#{lectureTotal},
				#{lectureGoal},
				#{lectureStart},
				#{lectureEnd},
				'Y'
			)	
			
	</insert>

</mapper>
