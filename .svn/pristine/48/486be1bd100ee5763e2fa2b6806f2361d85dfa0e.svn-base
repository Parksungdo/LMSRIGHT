<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.tut.dao.TaskDao">
	
	<!-- 강의 목록 조회 -->
	<select id="lectureList" resultType="kr.happyjob.study.tut.model.LectureModel">
		/* kr.happyjob.study.tut.dao.TaskDao.lectureList */
		
		select le.lecture_no as lectureNo
		      ,le.loginID as loginId
		      ,dc.detail_name as roomNo
		      ,le.lecture_person as lecturePerson
		      ,le.lecture_start as lectureStart
		      ,le.lecture_end as lectureEnd
		      ,us.name as tutName
          	  ,ledc.detail_name as lectureName
		 from tb_lecture le 
		      inner join tb_room rm on rm.lecture_no = le.lecture_no
		      inner join tb_userinfo us on us.loginId = le.loginId
		      inner join tb_detail_code dc on dc.group_code = 'number' and dc.detail_code = rm.number
          	  inner join tb_detail_code ledc on ledc.group_code = 'lecture_no' and ledc.detail_code = le.lecture_no
	    where le.loginID = #{loginid}
			<if test="(lectureNo != null) and (!lectureNo.equals(''))">
				and le.lecture_no = #{lectureNo}
			</if> 
		LIMIT #{startNum}, #{pageSize}
	</select>
	
	<select id="lectureListCnt" resultType="int">
		/* kr.happyjob.study.tut.dao.TaskDao.lectureListCnt */
		
		select count(*)
		 from tb_lecture le 
		 	  inner join tb_detail_code dc on dc.group_code = 'lecture_no' and dc.detail_code = le.lecture_no
	    where le.loginID = #{loginid}
			<if test="(lectureNo != null) and (!lectureNo.equals(''))">
				and le.lecture_no = #{lectureNo}
			</if>  
	</select>
	
	<!-- 강의계획서 목록 조회 -->
	<select id="planList" resultType="kr.happyjob.study.tut.model.PlanListModel">
	  /* kr.happyjob.study.tut.dao.TaskDao.planList */
	   select plan_no as planNo
            , lecture_no as lectureNo
            , plan_week as planWeek
            , plan_start as planStart
            , plan_end as planEnd
            , plan_goal as planGoal
         from tb_plan 	
          where lecture_no = #{lectureNo}
    </select>     
    
    <select id="planListCnt" resultType="int">
		/* kr.happyjob.study.tut.dao.TaskDao.planListCnt */
		select count(*)
		 from tb_plan 	 
			where lecture_no = #{lectureNo}
	</select>
    
    
	<!-- 과제관리 목록 조회 -->
	<select id="taskList" resultType="kr.happyjob.study.tut.model.TaskModel">
		/* kr.happyjob.study.tut.dao.TaskDao.taskList */
		
        select ts.lecture_no as lectureNo
        	  ,ts.plan_no as planNo
              ,ts.task_title as taskTitle
              ,ts.task_start as taskStart
              ,ts.task_end as taskEnd
         from tb_task ts
        where ts.plan_no = #{planNo}
        LIMIT #{startNum}, #{pageSize}
	</select>
	
	<!-- 목록수 -->
	<select id="taskListCnt" resultType="int">
		/* kr.happyjob.study.tut.dao.TaskDao.taskListCnt */
		
		select count(*)
		 from tb_task ts
	      where ts.plan_no = #{planNo}
	</select>
	
	
	<!-- 과제 상세조회 -->
	<select id="taskDetail" resultType="kr.happyjob.study.tut.model.TaskModel">
		/* kr.happyjob.study.tut.dao.TaskDao.taskDetail */
		
        select ts.lecture_no as lectureNo
        	  ,ts.plan_no as planNo
              ,ts.task_title as taskTitle
              ,ts.task_content as taskContent
              ,ts.task_start as taskStart
              ,ts.task_end as taskEnd
              ,ts.task_name as taskName
              ,ts.task_non as taskNon
              ,ts.task_mul as taskMul
              ,ts.plan_no as planNo
         from tb_task ts
        where ts.plan_no = #{planNo}
	</select>
	
	
	<!-- 제출 명단  -->
	<select id="tasksendinfo" resultType="kr.happyjob.study.tut.model.TaskSendModel">
		/* kr.happyjob.study.tut.dao.TaskDao.tasksendinfo */
		
		select sn.send_no as sendNo
              ,sn.lecture_no as lectureNo
              ,sn.plan_no as planNo
              ,sn.send_title as sendTitle
              ,sn.send_content as sendContent
              ,sn.send_date as sendDate
              ,sn.send_file as sendFile
              ,us.name as stdName
         from tb_send sn
              inner join tb_userinfo us on us.loginId = sn.loginID
        where sn.plan_no = ${planNo}       
	</select>
	<!-- 명단 목록 갯수 -->
	<select id="tasksnedtCnt" resultType="int">
		/* kr.happyjob.study.tut.dao.TaskDao.tasksnedtCnt */
		
		select count(*)
		 from tb_send sn
	      where sn.plan_no = #{planNo}
	</select>

	<!-- 과제 저장  -->
	<insert id="taskInsert">
		insert into tb_task
				(
				    plan_no 
				   , lecture_no 
				   , task_title 
				   , task_content
				   , task_start
				   , task_end
				   , task_name
				   , task_non
				   , task_mul	
				) values(
				   
				    #{planNo}
				   ,#{lectureNo}
				   ,#{title}				
				   ,#{content}				
				   ,#{taskStart}				
				   ,#{taskEnd}				
				   ,#{fileInfo.file_nm}				
				   ,#{fileInfo.file_loc}				
	               ,#{fileInfo.file_lloc}				
				)
				
	</insert>
    <!-- 과제 수정  -->
	<update id="taskUpdate">
		update tb_task
			set  plan_no = #{ planNo }
				, lecture_no = #{ lectureNo }
				, task_title = #{ title }
				, task_content = #{ content }
				, task_start = #{ taskStart }
				, task_end = #{ taskEnd }
				, task_name = #{ fileInfo.file_nm }
				, task_non = #{ fileInfo.file_loc }
				, task_mul = #{ fileInfo.file_lloc }
			where plan_no = #{planNo}
	
	</update>
	
</mapper>